<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Pod::Advent 0.21 (Pod::Simple 3.07, Perl::Tidy 20090616) on 2010-12-16 22:38:53 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>2010 Perl Advent Calendar: Oh Voronoi night&hellip;</title>
<link rel="stylesheet" href="../style.css" type="text/css" />
<link rel="alternate" type="text/plain" href="mod17.pod" />
</head>
<body>
<h1><a href="../">Perl Advent Calendar 2010-12</a>-17</h1>
<h2 align="center">Oh Voronoi night&hellip;</h2>
<h3 align="center">by Adam Russell</h3>
<p>Santa was having a horrible time co-ordinating the feeding of not only the big 8 reindeer (code names: comp, misc, news, rec, sci, soc, talk, and alt) but all their reindeer brothers and sisters, aunts and uncles, and various degrees of cousin. The reindeer are fed via 7 monolithic steel and concrete grain towers that were put in place centuries ago. Under the current reindeer village configuration some reindeer have to travel outside their neighborhood to get to a grain tower, and Reindeer factional tensions are on the rise.</p>
<p><img src="before.gif" height="400" width="400" alt="Historical Context" style="margin: auto; display: block" /></p>
<p>The neighborhoods must be redrawn so that each neighborhood has a central grain tower. Replacing or moving the grain towers would be prohibitively expensive. How do we design the new neighborhoods around each of the immovable grain towers? Santa had no idea so he called in his smartest elf&mdash;Hermey the Elf, D.D.S. Luckily Hermey had an ace up his sleeve by way of having had an elven education in computational geometry before developing an obsession for all things dental. He also knew Perl. With such a powerful peanut butter and chocolate combination on his side he quickly dashed out a script using <tt><a href="http://search.cpan.org/perldoc?Math::Geometry::Voronoi" title="Math::Geometry::Voronoi">Math::Geometry::Voronoi</a></tt> and the problem was solved! Because Santa wanted an easy to visualize executive summary he also used <a href="../../2000/10/">GD</a>and <a href="../../2010/13/">Tkx</a> to make some nice visualizations.</p>
<p>A voronoi diagram<sup><a href="#footnote_note0">1</a></sup> will create neighborhoods around each of the 7 grain towers so that each neighborhood has exactly one grain tower and that grain tower is the closest grain tower from any point in the neighborhood.</p>
<p>Making practical use of <tt>Math::Geometry::Voronoi</tt> was a little tricky at first though. There is a tempting function called <tt><span class="i">polygons</span><span class="s">(</span><span class="s">)</span></tt> which returns the computed polygons representing the neighborhoods. However, if you also overlay the points for the grain towers over the polygons the points don't necessarily fall inside the polygon.</p>
<p><img src="polygons.gif" height="400" width="400" alt="Why aren't the points inside the polygon?" style="margin: auto; display: block" /></p>
<p>Why is this? Well, the polygons that are returned have finite edges but the voronoi algorithm draws the neighborhoods so that they extend off of Santa's compound and off into the North Pole and beyond. By <a href="#mod17.pl.97">extending lines</a> to a far off point in the distance(off our canvas) we give the illusion of a line (well, technically a ray) extending to infinity. But this makes the visualization a little misleading so we <a href="#mod17.pl.63">remove some bells and whistles</a> to arrive at a simpler but more accurate representation.</p>
<p><img src="after.gif" height="400" width="400" alt="Why aren't the points inside the polygon?" style="margin: auto; display: block" /></p>
<a name="mod17.pl" id="mod17.pl"></a><h2><a href="mod17.pl">mod17.pl</a></h2><pre>
<a name="mod17.pl.1"></a>   1 <span class="c"># How to build reindeer neighborhoods. Other applications exist as well. </span>
<a name="mod17.pl.2"></a>   2 <span class="c"># Adam Russell ac.russell@live.com</span>
<a name="mod17.pl.3"></a>   3 
<a name="mod17.pl.4"></a>   4 <span class="k">use</span> <span class="w">GD</span><span class="sc">;</span>
<a name="mod17.pl.5"></a>   5 <span class="k">use</span> <span class="w">Tkx</span><span class="sc">;</span>
<a name="mod17.pl.6"></a>   6 <span class="k">use</span> <span class="w">Math::Geometry::Voronoi</span><span class="sc">;</span>
<a name="mod17.pl.7"></a>   7 
<a name="mod17.pl.8"></a>   8 <span class="k">my</span> <span class="i">$main_window</span> = <span class="w">Tkx::widget</span><span class="w">-&gt;new</span><span class="s">(</span><span class="q">&quot;.&quot;</span><span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.9"></a>   9 <span class="i">perl_advent_ui</span><span class="s">(</span><span class="i">$main_window</span><span class="s">)</span><span class="sc">;</span> 
<a name="mod17.pl.10"></a>  10 <span class="i">&amp;Tkx::MainLoop</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.11"></a>  11 
<a name="perl_advent_ui"></a>  12 <span class="k">sub </span><span class="m">perl_advent_ui</span> <span class="s">{</span>
<a name="mod17.pl.13"></a>  13     <span class="k">my</span> <span class="s">(</span><span class="i">$root</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>  
<a name="mod17.pl.14"></a>  14     <span class="k">my</span> <span class="i">@points</span>= <span class="s">(</span><span class="s">[</span><span class="n">272</span><span class="cm">,</span><span class="n">39</span><span class="s">]</span><span class="cm">,</span>
<a name="mod17.pl.15"></a>  15 		 <span class="s">[</span><span class="n">130</span><span class="cm">,</span><span class="n">43</span><span class="s">]</span><span class="cm">,</span>
<a name="mod17.pl.16"></a>  16 		 <span class="s">[</span><span class="n">87</span><span class="cm">,</span><span class="n">112</span><span class="s">]</span><span class="cm">,</span>
<a name="mod17.pl.17"></a>  17 		 <span class="s">[</span><span class="n">294</span><span class="cm">,</span><span class="n">114</span><span class="s">]</span><span class="cm">,</span>
<a name="mod17.pl.18"></a>  18 		 <span class="s">[</span><span class="n">166</span><span class="cm">,</span><span class="n">124</span><span class="s">]</span><span class="cm">,</span>
<a name="mod17.pl.19"></a>  19 		 <span class="s">[</span><span class="n">247</span><span class="cm">,</span><span class="n">206</span><span class="s">]</span><span class="cm">,</span>
<a name="mod17.pl.20"></a>  20 		 <span class="s">[</span><span class="n">93</span><span class="cm">,</span><span class="n">208</span><span class="s">]</span><span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.21"></a>  21 
<a name="mod17.pl.22"></a>  22     <span class="k">my</span> <span class="i">@gd_polys</span>=<span class="i">create_voronoi_polygons</span><span class="s">(</span><span class="i">@points</span><span class="s">)</span><span class="sc">;</span>    
<a name="mod17.pl.23"></a>  23     <span class="k">my</span> <span class="i">@gd_edges</span>=<span class="i">create_voronoi_edges</span><span class="s">(</span><span class="i">@points</span><span class="s">)</span><span class="sc">;</span>    
<a name="mod17.pl.24"></a>  24     <span class="k">my</span> <span class="i">$img_filename</span>=<span class="i">encode_voronoi_image</span><span class="s">(</span>\<span class="i">@gd_polys</span><span class="cm">,</span>\<span class="i">@gd_edges</span><span class="cm">,</span> \<span class="i">@points</span><span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.25"></a>  25     <span class="k">my</span> <span class="i">$canvas</span> = <span class="i">$root</span><span class="i">-&gt;new_tk__canvas</span><span class="s">(</span>-<span class="w">width</span> <span class="cm">=&gt;</span> <span class="n">400</span><span class="cm">,</span> -<span class="w">height</span> <span class="cm">=&gt;</span> <span class="n">350</span><span class="s">)</span><span class="sc">;</span>    
<a name="mod17.pl.26"></a>  26     <span class="k">my</span> <span class="i">$voronoi_image</span>=<span class="i">Tkx::image_create_photo</span><span class="s">(</span>-<span class="w">file</span> <span class="cm">=&gt;</span> <span class="i">$img_filename</span><span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.27"></a>  27     <span class="k">my</span> <span class="i">$voronoi_tag</span>=<span class="q">&quot;voronoi_diagram&quot;</span><span class="sc">;</span>
<a name="mod17.pl.28"></a>  28     <span class="i">$canvas</span><span class="i">-&gt;create_image</span><span class="s">(</span><span class="s">[</span><span class="n">200</span><span class="cm">,</span><span class="n">200</span><span class="s">]</span><span class="cm">,</span>-<span class="w">image</span> <span class="cm">=&gt;</span> <span class="i">$voronoi_image</span><span class="cm">,</span> -<span class="w">tag</span><span class="cm">=&gt;</span><span class="i">$voronoi_tag</span><span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.29"></a>  29     <span class="i">$canvas</span><span class="i">-&gt;g_grid</span><span class="s">(</span>-<span class="w">column</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="cm">,</span> -<span class="w">row</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.30"></a>  30 <span class="s">}</span>
<a name="mod17.pl.31"></a>  31 
<a name="create_voronoi_polygons"></a>  32 <span class="k">sub </span><span class="m">create_voronoi_polygons</span><span class="s">{</span>
<a name="mod17.pl.33"></a>  33     <span class="k">my</span><span class="s">(</span><span class="i">@points</span><span class="s">)</span>=<span class="i">@_</span><span class="sc">;</span>
<a name="mod17.pl.34"></a>  34     <span class="k">my</span> <span class="i">$geo</span> = <span class="w">Math::Geometry::Voronoi</span><span class="w">-&gt;new</span><span class="s">(</span><span class="w">points</span> <span class="cm">=&gt;</span> \<span class="i">@points</span><span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.35"></a>  35     <span class="i">$geo</span><span class="i">-&gt;compute</span><span class="sc">;</span>    
<a name="mod17.pl.36"></a>  36     <span class="k">my</span> <span class="i">@geo_polys</span> = <span class="i">$geo</span><span class="i">-&gt;polygons</span><span class="sc">;</span>    
<a name="mod17.pl.37"></a>  37     <span class="k">my</span> <span class="i">@gd_polys</span><span class="sc">;</span>
<a name="mod17.pl.38"></a>  38     <span class="k">foreach</span>  <span class="k">my</span> <span class="i">$geo_poly</span> <span class="s">(</span><span class="i">@geo_polys</span><span class="s">)</span><span class="s">{</span>
<a name="mod17.pl.39"></a>  39         <span class="k">unshift</span> <span class="i">@gd_polys</span><span class="cm">,</span><span class="i">create_gd_poly</span><span class="s">(</span><span class="i">@</span>{<span class="i">$geo_poly</span>}[<span class="n">1</span>..<span class="i">$#</span>{<span class="i">$geo_poly</span>}]<span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.40"></a>  40     <span class="s">}</span>
<a name="mod17.pl.41"></a>  41     <span class="k">return</span> <span class="i">@gd_polys</span><span class="sc">;</span>
<a name="mod17.pl.42"></a>  42 <span class="s">}</span>
<a name="mod17.pl.43"></a>  43 
<a name="create_voronoi_edges"></a>  44 <span class="k">sub </span><span class="m">create_voronoi_edges</span><span class="s">{</span>
<a name="mod17.pl.45"></a>  45     <span class="k">my</span><span class="s">(</span><span class="i">@points</span><span class="s">)</span>=<span class="i">@_</span><span class="sc">;</span>
<a name="mod17.pl.46"></a>  46     <span class="k">my</span> <span class="i">$geo</span> = <span class="w">Math::Geometry::Voronoi</span><span class="w">-&gt;new</span><span class="s">(</span><span class="w">points</span> <span class="cm">=&gt;</span> \<span class="i">@points</span><span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.47"></a>  47     <span class="i">$geo</span><span class="i">-&gt;compute</span><span class="sc">;</span>    
<a name="mod17.pl.48"></a>  48     <span class="k">my</span> <span class="i">@geo_edges</span> = <span class="i">$geo</span><span class="i">-&gt;edges</span><span class="sc">;</span>    
<a name="mod17.pl.49"></a>  49     <span class="k">my</span> <span class="i">@gd_edges</span><span class="sc">;</span>
<a name="mod17.pl.50"></a>  50 <span class="k">print</span> <span class="i">pp</span> <span class="i">$geo</span><span class="i">-&gt;edges</span><span class="sc">;</span>     
<a name="mod17.pl.51"></a>  51     <span class="k">foreach</span>  <span class="k">my</span> <span class="i">$geo_edge</span> <span class="s">(</span><span class="i">@geo_edges</span><span class="s">)</span><span class="s">{</span>
<a name="mod17.pl.52"></a>  52         <span class="k">unshift</span> <span class="i">@gd_edges</span><span class="cm">,</span><span class="i">create_gd_edge</span><span class="s">(</span><span class="i">@</span>{<span class="i">$geo_edge</span>}[<span class="n">0</span>..<span class="i">$#</span>{<span class="i">$geo_edge</span>}]<span class="cm">,</span><span class="i">$geo</span><span class="i">-&gt;vertices</span><span class="cm">,</span><span class="i">$geo</span><span class="i">-&gt;lines</span><span class="cm">,</span><span class="i">$geo</span><span class="i">-&gt;points</span><span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.53"></a>  53     <span class="s">}</span>    
<a name="mod17.pl.54"></a>  54     <span class="k">return</span> <span class="i">@gd_edges</span><span class="sc">;</span>
<a name="mod17.pl.55"></a>  55 <span class="s">}</span>
<a name="mod17.pl.56"></a>  56 
<a name="encode_voronoi_image"></a>  57 <span class="k">sub </span><span class="m">encode_voronoi_image</span><span class="s">{</span>
<a name="mod17.pl.58"></a>  58     <span class="k">my</span><span class="s">(</span><span class="i">$polys</span><span class="cm">,</span><span class="i">$lines</span><span class="cm">,</span> <span class="i">$points</span><span class="s">)</span>=<span class="i">@_</span><span class="sc">;</span>
<a name="mod17.pl.59"></a>  59     <span class="k">my</span> <span class="i">$mode</span>=<span class="q">&quot;&gt;:raw&quot;</span><span class="sc">;</span>
<a name="mod17.pl.60"></a>  60     <span class="k">my</span> <span class="i">$filename</span>=<span class="q">&quot;voronoi.gif&quot;</span><span class="sc">;</span>
<a name="mod17.pl.61"></a>  61     <span class="k">my</span> <span class="i">$img</span> = <span class="w">GD::Image</span><span class="w">-&gt;new</span><span class="s">(</span><span class="n">400</span><span class="cm">,</span><span class="n">400</span><span class="cm">,</span><span class="n">1</span><span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.62"></a>  62     <span class="i">$img</span><span class="i">-&gt;filledRectangle</span><span class="s">(</span><span class="n">0</span><span class="cm">,</span><span class="n">0</span><span class="cm">,</span><span class="n">500</span><span class="cm">,</span><span class="n">500</span><span class="cm">,</span><span class="n">0x00ffffff</span><span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.63"></a>  63     <span class="c">#my $k=0;   </span>
<a name="mod17.pl.64"></a>  64     <span class="c">#my @color_array=(255,0,0); </span>
<a name="mod17.pl.65"></a>  65     <span class="c">#foreach my $poly (@{$polys}) {</span>
<a name="mod17.pl.66"></a>  66     <span class="c">#    my $color=$img-&gt;colorAllocate($color_array[0],$color_array[1],$color_array[2]);</span>
<a name="mod17.pl.67"></a>  67     <span class="c">#    $img-&gt;openPolygon($poly,$color);</span>
<a name="mod17.pl.68"></a>  68     <span class="c">#    if($k%2==0){</span>
<a name="mod17.pl.69"></a>  69     <span class="c">#        $color_array[0]-=50;#every other time through the loop take the color down a notch   </span>
<a name="mod17.pl.70"></a>  70     <span class="c">#                            #to get a small shading effect  </span>
<a name="mod17.pl.71"></a>  71     <span class="c">#    }   </span>
<a name="mod17.pl.72"></a>  72     <span class="c">#    ($color_array[1],$color_array[0],$color_array[2])=($color_array[0],$color_array[1],$color_array[2]);#each time through alternate red/green polys for a Christmas color scheme      </span>
<a name="mod17.pl.73"></a>  73     <span class="c">#    $k++;  </span>
<a name="mod17.pl.74"></a>  74     <span class="c">#}   </span>
<a name="mod17.pl.75"></a>  75     <span class="k">my</span> <span class="i">$color_black</span>=<span class="i">$img</span><span class="i">-&gt;colorAllocate</span><span class="s">(</span><span class="n">0</span><span class="cm">,</span><span class="n">0</span><span class="cm">,</span><span class="n">0</span><span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.76"></a>  76     <span class="k">foreach</span> <span class="k">my</span> <span class="i">$line</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$lines</span>}<span class="s">)</span> <span class="s">{</span>
<a name="mod17.pl.77"></a>  77         <span class="i">$img</span><span class="i">-&gt;line</span><span class="s">(</span><span class="i">$</span>{<span class="i">$line</span>}[<span class="n">0</span>]<span class="cm">,</span><span class="i">$</span>{<span class="i">$line</span>}[<span class="n">1</span>]<span class="cm">,</span><span class="i">$</span>{<span class="i">$line</span>}[<span class="n">2</span>]<span class="cm">,</span><span class="i">$</span>{<span class="i">$line</span>}[<span class="n">3</span>]<span class="cm">,</span><span class="i">$color_black</span><span class="s">)</span> 
<a name="mod17.pl.78"></a>  78     <span class="s">}</span>  
<a name="mod17.pl.79"></a>  79     <span class="k">foreach</span> <span class="k">my</span> <span class="i">$point</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$points</span>}<span class="s">)</span> <span class="s">{</span>
<a name="mod17.pl.80"></a>  80         <span class="i">$img</span><span class="i">-&gt;filledArc</span><span class="s">(</span><span class="i">$</span>{<span class="i">$point</span>}[<span class="n">0</span>]<span class="cm">,</span><span class="i">$</span>{<span class="i">$point</span>}[<span class="n">1</span>]<span class="cm">,</span><span class="n">3</span><span class="cm">,</span><span class="n">3</span><span class="cm">,</span><span class="n">0</span><span class="cm">,</span><span class="n">360</span><span class="cm">,</span><span class="i">$color_black</span><span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.81"></a>  81     <span class="s">}</span>  
<a name="mod17.pl.82"></a>  82     <span class="k">open</span>  <span class="w">IMG</span><span class="cm">,</span> <span class="i">$mode</span><span class="cm">,</span> <span class="i">$filename</span>  <span class="k">or</span> <span class="k">die</span> <span class="i">$!</span><span class="sc">;</span>
<a name="mod17.pl.83"></a>  83     <span class="k">print</span> <span class="i">IMG</span> <span class="i">$img</span><span class="i">-&gt;gif</span><span class="sc">;</span>
<a name="mod17.pl.84"></a>  84     <span class="k">close</span> <span class="w">IMG</span><span class="sc">;</span>
<a name="mod17.pl.85"></a>  85     <span class="k">return</span> <span class="i">$filename</span><span class="sc">;</span>
<a name="mod17.pl.86"></a>  86 <span class="s">}</span>
<a name="mod17.pl.87"></a>  87 
<a name="create_gd_poly"></a>  88 <span class="k">sub </span><span class="m">create_gd_poly</span><span class="s">{</span>
<a name="mod17.pl.89"></a>  89     <span class="k">my</span><span class="s">(</span><span class="i">@points</span><span class="s">)</span>=<span class="i">@_</span><span class="sc">;</span>
<a name="mod17.pl.90"></a>  90     <span class="k">my</span> <span class="i">$pgon</span>=<span class="w">new</span> <span class="w">GD::Polygon</span><span class="sc">;</span>
<a name="mod17.pl.91"></a>  91     <span class="k">foreach</span> <span class="k">my</span> <span class="i">$point</span> <span class="s">(</span><span class="i">@points</span><span class="s">)</span><span class="s">{</span>
<a name="mod17.pl.92"></a>  92         <span class="i">$pgon</span><span class="i">-&gt;addPt</span><span class="s">(</span><span class="i">@</span>{<span class="i">$point</span>}<span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.93"></a>  93     <span class="s">}</span>
<a name="mod17.pl.94"></a>  94     <span class="k">return</span> <span class="i">$pgon</span><span class="sc">;</span>
<a name="mod17.pl.95"></a>  95 <span class="s">}</span>
<a name="mod17.pl.96"></a>  96 
<a name="create_gd_edge"></a>  97 <span class="k">sub </span><span class="m">create_gd_edge</span><span class="s">{</span>
<a name="mod17.pl.98"></a>  98     <span class="k">my</span> <span class="i">$points</span>=<span class="k">pop</span> <span class="i">@_</span><span class="sc">;</span>
<a name="mod17.pl.99"></a>  99     <span class="k">my</span> <span class="i">$lines</span>=<span class="k">pop</span> <span class="i">@_</span><span class="sc">;</span>
<a name="mod17.pl.100"></a> 100     <span class="k">my</span> <span class="i">$vertices</span>=<span class="k">pop</span> <span class="i">@_</span><span class="sc">;</span>
<a name="mod17.pl.101"></a> 101     <span class="k">my</span><span class="s">(</span><span class="i">@edges</span><span class="s">)</span>=<span class="i">@_</span><span class="sc">;</span>
<a name="mod17.pl.102"></a> 102     <span class="k">my</span> <span class="i">@gd_endpoints</span><span class="sc">;</span>
<a name="mod17.pl.103"></a> 103     <span class="k">foreach</span> <span class="k">my</span> <span class="i">$edge</span> <span class="s">(</span><span class="i">@edges</span><span class="s">)</span><span class="s">{</span>
<a name="mod17.pl.104"></a> 104         <span class="k">my</span> <span class="i">$l_index</span>=<span class="i">$</span>{<span class="i">$edge</span>}[<span class="n">0</span>]<span class="sc">;</span>
<a name="mod17.pl.105"></a> 105         <span class="k">my</span><span class="s">(</span><span class="i">$v_index</span><span class="cm">,</span><span class="i">$x1</span><span class="cm">,</span><span class="i">$y1</span><span class="cm">,</span><span class="i">$x2</span><span class="cm">,</span><span class="i">$y2</span><span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.106"></a> 106         <span class="k">if</span><span class="s">(</span><span class="i">$</span>{<span class="i">$edge</span>}[<span class="n">1</span>]!=<span class="n">-1</span><span class="s">)</span><span class="s">{</span>  
<a name="mod17.pl.107"></a> 107             <span class="i">$v_index</span>=<span class="i">$</span>{<span class="i">$edge</span>}[<span class="n">1</span>]<span class="sc">;</span>
<a name="mod17.pl.108"></a> 108             <span class="s">(</span><span class="i">$x1</span><span class="cm">,</span><span class="i">$y1</span><span class="s">)</span>=<span class="s">(</span><span class="i">$</span>{<span class="i">$vertices</span>}[<span class="i">$v_index</span>][<span class="n">0</span>]<span class="cm">,</span><span class="i">$</span>{<span class="i">$vertices</span>}[<span class="i">$v_index</span>][<span class="n">1</span>]<span class="s">)</span><span class="sc">;</span>            
<a name="mod17.pl.109"></a> 109         <span class="s">}</span>
<a name="mod17.pl.110"></a> 110         <span class="k">if</span><span class="s">(</span><span class="i">$</span>{<span class="i">$edge</span>}[<span class="n">2</span>]!=<span class="n">-1</span><span class="s">)</span><span class="s">{</span>  
<a name="mod17.pl.111"></a> 111             <span class="i">$v_index</span>=<span class="i">$</span>{<span class="i">$edge</span>}[<span class="n">2</span>]<span class="sc">;</span>
<a name="mod17.pl.112"></a> 112             <span class="s">(</span><span class="i">$x2</span><span class="cm">,</span><span class="i">$y2</span><span class="s">)</span>=<span class="s">(</span><span class="i">$</span>{<span class="i">$vertices</span>}[<span class="i">$v_index</span>][<span class="n">0</span>]<span class="cm">,</span><span class="i">$</span>{<span class="i">$vertices</span>}[<span class="i">$v_index</span>][<span class="n">1</span>]<span class="s">)</span><span class="sc">;</span>            
<a name="mod17.pl.113"></a> 113         <span class="s">}</span>  
<a name="mod17.pl.114"></a> 114         <span class="k">my</span><span class="s">(</span><span class="i">$a</span><span class="cm">,</span><span class="i">$b</span><span class="cm">,</span><span class="i">$c</span><span class="s">)</span><span class="sc">;</span><span class="c">#used for expressing the line in ax+by=c form</span>
<a name="mod17.pl.115"></a> 115         <span class="i">$a</span>=<span class="i">$</span>{<span class="i">$lines</span>}[<span class="i">$l_index</span>][<span class="n">0</span>]<span class="sc">;</span>
<a name="mod17.pl.116"></a> 116         <span class="i">$b</span>=<span class="i">$</span>{<span class="i">$lines</span>}[<span class="i">$l_index</span>][<span class="n">1</span>]<span class="sc">;</span>
<a name="mod17.pl.117"></a> 117         <span class="i">$c</span>=<span class="i">$</span>{<span class="i">$lines</span>}[<span class="i">$l_index</span>][<span class="n">2</span>]<span class="sc">;</span>
<a name="mod17.pl.118"></a> 118         <span class="k">if</span><span class="s">(</span><span class="i">$</span>{<span class="i">$edge</span>}[<span class="n">1</span>]==<span class="n">-1</span><span class="s">)</span><span class="s">{</span>          
<a name="mod17.pl.119"></a> 119             <span class="k">if</span><span class="s">(</span><span class="i">$b</span><span class="s">)</span><span class="s">{</span>
<a name="mod17.pl.120"></a> 120                 <span class="c">#if b is non-zero then the slope is -a/b</span>
<a name="mod17.pl.121"></a> 121                 <span class="k">my</span> <span class="i">$m</span>=<span class="n">-1</span>*<span class="i">$a</span>/<span class="i">$b</span><span class="sc">;</span>
<a name="mod17.pl.122"></a> 122                 <span class="c">#calculate the y intercept</span>
<a name="mod17.pl.123"></a> 123                 <span class="k">my</span> <span class="i">$y_int</span>=<span class="i">$y2</span>-<span class="s">(</span><span class="i">$m</span>*<span class="i">$x2</span><span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.124"></a> 124                 <span class="c">#Now set an extreme endpoint for the start of our line closer to the origin</span>
<a name="mod17.pl.125"></a> 125                 <span class="i">$x1</span>=<span class="n">1</span><span class="sc">;</span>
<a name="mod17.pl.126"></a> 126                 <span class="i">$y1</span>=<span class="i">$m</span>*<span class="i">$x1</span>+<span class="i">$y_int</span><span class="sc">;</span>
<a name="mod17.pl.127"></a> 127             <span class="s">}</span>  
<a name="mod17.pl.128"></a> 128         <span class="s">}</span>
<a name="mod17.pl.129"></a> 129         <span class="k">if</span><span class="s">(</span><span class="i">$</span>{<span class="i">$edge</span>}[<span class="n">2</span>]==<span class="n">-1</span><span class="s">)</span><span class="s">{</span>
<a name="mod17.pl.130"></a> 130             <span class="k">if</span><span class="s">(</span><span class="i">$b</span><span class="s">)</span><span class="s">{</span>
<a name="mod17.pl.131"></a> 131                 <span class="c">#if b is non-zero then the slope is -a/b</span>
<a name="mod17.pl.132"></a> 132                 <span class="k">my</span> <span class="i">$m</span>=<span class="n">-1</span>*<span class="i">$a</span>/<span class="i">$b</span><span class="sc">;</span>
<a name="mod17.pl.133"></a> 133                 <span class="c">#calculate the y intercept</span>
<a name="mod17.pl.134"></a> 134                 <span class="k">my</span> <span class="i">$y_int</span>=<span class="i">$y2</span>-<span class="s">(</span><span class="i">$m</span>*<span class="i">$x2</span><span class="s">)</span><span class="sc">;</span>
<a name="mod17.pl.135"></a> 135                 <span class="c">#Now set an extreme endpoint to represent oo in our visualization</span>
<a name="mod17.pl.136"></a> 136                 <span class="i">$x2</span>=<span class="n">1000</span><span class="sc">;</span>
<a name="mod17.pl.137"></a> 137                 <span class="i">$y2</span>=<span class="i">$m</span>*<span class="i">$x2</span>+<span class="i">$y_int</span><span class="sc">;</span>
<a name="mod17.pl.138"></a> 138             <span class="s">}</span>  
<a name="mod17.pl.139"></a> 139         <span class="s">}</span>
<a name="mod17.pl.140"></a> 140         <span class="k">if</span><span class="s">(</span>!<span class="i">$b</span><span class="s">)</span><span class="s">{</span><span class="c">#if b is 0 then we just have a vertical line</span>
<a name="mod17.pl.141"></a> 141                 <span class="i">$x1</span>=<span class="i">$c</span>/<span class="i">$a</span><span class="sc">;</span> 
<a name="mod17.pl.142"></a> 142                 <span class="i">$y1</span>=<span class="k">rand</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span><span class="c">#any random value will do</span>
<a name="mod17.pl.143"></a> 143                 <span class="i">$x2</span>=<span class="i">$c</span>/<span class="i">$a</span><span class="sc">;</span>
<a name="mod17.pl.144"></a> 144                 <span class="i">$y2</span>=<span class="k">rand</span><span class="s">(</span><span class="n">1000</span><span class="s">)</span><span class="sc">;</span><span class="c">#any random value will do</span>
<a name="mod17.pl.145"></a> 145         <span class="s">}</span>
<a name="mod17.pl.146"></a> 146         <span class="k">unshift</span> <span class="i">@gd_endpoints</span><span class="cm">,</span><span class="s">[</span><span class="i">$x1</span><span class="cm">,</span><span class="i">$y1</span><span class="cm">,</span><span class="i">$x2</span><span class="cm">,</span><span class="i">$y2</span><span class="s">]</span><span class="sc">;</span>
<a name="mod17.pl.147"></a> 147     <span class="s">}</span> 
<a name="mod17.pl.148"></a> 148     <span class="k">return</span> <span class="i">@gd_endpoints</span><span class="sc">;</span>
<a name="mod17.pl.149"></a> 149 <span class="s">}</span>
</pre>
<p><a name="footnote_note0" id="footnote_note0"></a>1. Deeper info about Voronoi diagrams <a href="http://mathworld.wolfram.com/VoronoiDiagram.html"> via Mathworld</a>.<br>
</p>
<div style="float: right; font-size: 10pt"><a href="mod17.pod">View Source (POD)</a></div><br />
</body>
</html>
