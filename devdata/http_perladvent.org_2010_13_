<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Pod::Advent 0.21 (Pod::Simple 3.07, Perl::Tidy 20090616) on 2010-12-14 00:00:44 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>2010 Perl Advent Calendar: Tkx Tkx Tkx&hellip; is Christmas every going to get here?</title>
<link rel="stylesheet" href="../style.css" type="text/css" />
<link rel="alternate" type="text/plain" href="mod13.pod" />
</head>
<body>
<h1><a href="../">Perl Advent Calendar 2010-12</a>-13</h1>
<h2 align="center">Tkx Tkx Tkx&hellip; is Christmas every going to get here?</h2>
<h3 align="center">by Adam Russell</h3>
<p>Sure, there are perl APIs that bind QT, Win32, Gtk, and other GUI APIs but Tk is the classic and in many minds the default option for writing GUI code in Perl. Unfortunately, if you must implement a GUI for one of your applications the prospect of using <tt>Tcl::Tk</tt> is about as exciting as receiving a lump of coal in your stocking. The problem is that Perl/Tk was designed to circumvent Tk's natural Tcl interface, and <tt>Tcl::Tk</tt> took over the maintenance of this design. At its core is a modified version of Tk which few to none of the elves at Santa's toy factory want to maintain&mdash;the poor little guys run in terror at the prospect! So, while Tk has continued to evolve Perl is still bound to a fairly rusty version of Tk. ActiveState's solution to this is to implement a Perl-Tcl wrapper to Tk called <tt><a href="http://search.cpan.org/perldoc?Tkx" title="Tkx">Tkx</a></tt>. The goal of <tt><span title="Tkx">Tkx</span></tt> is to provide a clean and maintainable interface to the Tk widget set that can be used for many Christmases to come<sup><a href="#footnote_note0">1</a></sup>. <tt><span title="Tkx">Tkx</span></tt> is really little more than a wrapper that translates perl to Tcl and then invokes a Tcl interpreter. This however, allows us to take full advantage of every modern feature of Tcl/Tk. Huzzah! Our Tk interface no longer look as if it was written in 1995!</p>
<p>Since we are wrapping Tcl code syntax may seem a bit odd at first. Since <tt><span title="Tkx">Tkx</span></tt> is such a massive API we'll proceed immediately to an example that tries to pack in as many routines as possible.</p>
<p>Of particular interest are calls like <a href="#mod13.pl.30">new_ttk_checkbutton</a>. This is the <tt><span title="Tkx">Tkx</span></tt> analog of Tcl's <tt><span class="w">ttk::checkbutton</span></tt>; constructors always begin with <span style="font-style: italic">new_</span>. In general this style of naming is used for Tcl commands in Perl, with underscores representing spaces and colons.</p>
<p>In addition, <span style="font-style: italic">g_</span> methods like <tt><span class="w">g_grid</span></tt> invoke the corresponding Tk command with the widget path as an argument, which we use to <a href="#mod13.pl.42">assign the button to its place</a> in the grid layout. Besides object paths we can use unique widget IDs&mdash;returned by their creators&mdash;or "tags"<sup><a href="#footnote_note1">2</a></sup> to easily identify and modify behavior of objects drawn on the canvas. For example, in the <tt><span class="i">blink_switch</span><span class="s">(</span><span class="s">)</span></tt> sub on <a href="#mod13.pl.94">lines 94-112</a> we pass in an array of IDs representing the lights. It is these that are used by the canvas's <tt><span class="w">itemconfigure</span></tt> function to toggle the lights when blinking is enabled.</p>
<p>On <a href="#mod13.pl.90">lines 90&ndash;91</a> we engage in a little trick to get a simple "blink" animation. The <tt><span class="i">blink_lights</span><span class="s">(</span><span class="s">)</span></tt> sub calls a hand made repeat function which mimics the Tk APIs <tt>Tk::Repeat</tt>; which is itself just a convenience wrapper around <tt>Tk::After</tt>. Essentially we are creating a thread that runs in the background and if our <tt><span class="i">$do_blink</span></tt> variable is set by <tt><span class="i">$checkbox_blink</span></tt> then we blink the lights.</p>
<p><img src="screenshot.png" height="442" width="360" alt="Screenshot" style="margin: auto; display: block" /></p>
<p>For more advanced usages you need to look at the <a href="http://docs.activestate.com/activetcl/8.5/at.pkg_index.html">Tcl/Tk docs</a> directly and then craft the appropriate <tt><span title="Tkx">Tkx</span></tt> call. <a href="http://docs.activestate.com/activeperl/5.8/lib/Tkx/Tutorial.html">Activestate'stutorials</a> shows some of examples of this. <a href="http://www.tkdocs.com/tutorial/">Tkdocs</a> also has a ton of great info on Tk functions.</p>
<blockquote><p>If Perl segfaults when you try to <tt><span class="k">use</span> <span class="w">Tcl</span></tt> try the following before rebuilding it: <a href="http://www.nntp.perl.org/group/perl.tcltk/2009/08/msg283.html">perl Makefile.PL --nousestubs</a></p>
</blockquote>
<a name="mod13.pl" id="mod13.pl"></a><h2><a href="mod13.pl">mod13.pl</a></h2><pre>
<a name="mod13.pl.1"></a>   1 <span class="c"># A fun little Christmas themed Tkx app.</span>
<a name="mod13.pl.2"></a>   2 <span class="c"># Adam Russell ac.russell@live.com</span>
<a name="mod13.pl.3"></a>   3 <span class="k">use</span> <span class="w">Tkx</span><span class="sc">;</span>
<a name="mod13.pl.4"></a>   4 
<a name="mod13.pl.5"></a>   5 <span class="k">my</span> <span class="i">$main_window</span> = <span class="w">Tkx::widget</span><span class="w">-&gt;new</span><span class="s">(</span><span class="q">&quot;.&quot;</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.6"></a>   6 <span class="i">perl_advent_ui</span><span class="s">(</span><span class="i">$main_window</span><span class="s">)</span><span class="sc">;</span> 
<a name="mod13.pl.7"></a>   7 <span class="i">&amp;Tkx::MainLoop</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.8"></a>   8 
<a name="mod13.pl.9"></a>   9 <span class="c">#Layout the ui. This sort of thing is generally easier in a RAD tool</span>
<a name="mod13.pl.10"></a>  10 <span class="c">#like specTcl or ZooZ but our layout is straightforward enough</span>
<a name="perl_advent_ui"></a>  11 <span class="k">sub </span><span class="m">perl_advent_ui</span> <span class="s">{</span>
<a name="mod13.pl.12"></a>  12     <span class="k">my</span> <span class="s">(</span><span class="i">$root</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>  
<a name="mod13.pl.13"></a>  13     <span class="k">my</span> <span class="i">$extra_nice_selected</span>=<span class="n">0</span><span class="sc">;</span>
<a name="mod13.pl.14"></a>  14     <span class="k">my</span> <span class="i">$do_blink</span>=<span class="n">0</span><span class="sc">;</span>
<a name="mod13.pl.15"></a>  15     <span class="k">my</span> <span class="i">$canvas</span> = <span class="i">$root</span><span class="i">-&gt;new_tk__canvas</span><span class="s">(</span>-<span class="w">width</span> <span class="cm">=&gt;</span> <span class="n">340</span><span class="cm">,</span> -<span class="w">height</span> <span class="cm">=&gt;</span> <span class="n">350</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.16"></a>  16     
<a name="mod13.pl.17"></a>  17     <span class="c"># All images from www.openclipart.org</span>
<a name="mod13.pl.18"></a>  18     <span class="c">#     christmas tree: www.openclipart.org/detail/15032</span>
<a name="mod13.pl.19"></a>  19     <span class="c">#     presents      : www.openclipart.org/detail/98539</span>
<a name="mod13.pl.20"></a>  20     <span class="c">#     cat           : www.openclipart.org/detail/33241</span>
<a name="mod13.pl.21"></a>  21     <span class="k">my</span> <span class="i">$presents_image</span>=<span class="i">Tkx::image_create_photo</span><span class="s">(</span>-<span class="w">file</span> <span class="cm">=&gt;</span> <span class="q">&quot;<a href="xmas-presents_0.gif">xmas-presents_0.gif</a>&quot;</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.22"></a>  22     <span class="k">my</span> <span class="i">$presents_tag</span>=<span class="q">&quot;presents&quot;</span><span class="sc">;</span>
<a name="mod13.pl.23"></a>  23     <span class="k">my</span> <span class="i">$kitten_image</span>=<span class="i">Tkx::image_create_photo</span><span class="s">(</span><span class="q">&quot;kitten&quot;</span><span class="cm">,</span> -<span class="w">file</span> <span class="cm">=&gt;</span> <span class="q">&quot;<a href="kitten_0.gif">kitten_0.gif</a>&quot;</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.24"></a>  24     <span class="k">my</span> <span class="i">$kitten_tag</span>=<span class="q">&quot;kitten&quot;</span><span class="sc">;</span>
<a name="mod13.pl.25"></a>  25     <span class="k">my</span> <span class="i">$tree_image</span>=<span class="i">Tkx::image_create_photo</span><span class="s">(</span>-<span class="w">file</span> <span class="cm">=&gt;</span> <span class="q">&quot;<a href="tree_0.gif">tree_0.gif</a>&quot;</span><span class="s">)</span><span class="sc">;</span> 
<a name="mod13.pl.26"></a>  26     <span class="k">my</span> <span class="i">$tree_tag</span>=<span class="q">&quot;tree&quot;</span><span class="sc">;</span>
<a name="mod13.pl.27"></a>  27     <span class="i">$canvas</span><span class="i">-&gt;create_image</span><span class="s">(</span><span class="s">[</span><span class="n">172</span><span class="cm">,</span><span class="n">175</span><span class="s">]</span><span class="cm">,</span>-<span class="w">image</span> <span class="cm">=&gt;</span> <span class="i">$tree_image</span><span class="cm">,</span> -<span class="w">tag</span><span class="cm">=&gt;</span><span class="i">$tree_tag</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.28"></a>  28     <span class="k">my</span> <span class="i">@lights</span>=<span class="i">string_lights</span><span class="s">(</span>\<span class="i">$canvas</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.29"></a>  29    
<a name="mod13.pl.30"></a>  30     <span class="k">my</span> <span class="i">$checkbox_blink</span>=<span class="i">$root</span><span class="i">-&gt;new_ttk__checkbutton</span><span class="s">(</span>-<span class="w">text</span> <span class="cm">=&gt;</span> <span class="q">&quot;Blink Lights&quot;</span><span class="cm">,</span> 
<a name="mod13.pl.31"></a>  31 	                 -<span class="w">variable</span> <span class="cm">=&gt;</span> \<span class="i">$do_blink</span><span class="cm">,</span> -<span class="w">onvalue</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span> -<span class="w">offvalue</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.32"></a>  32     <span class="k">my</span> <span class="i">$checkbox_xnice</span> = <span class="i">$root</span><span class="i">-&gt;new_ttk__checkbutton</span><span class="s">(</span>-<span class="w">text</span> <span class="cm">=&gt;</span> <span class="q">&quot;Extra Nice   &quot;</span><span class="cm">,</span> -<span class="w">command</span> <span class="cm">=&gt;</span> <span class="k">sub</span><span class="s">{</span><span class="i">extra_nice</span><span class="s">(</span>\<span class="i">$canvas</span><span class="cm">,</span>\<span class="i">$extra_nice_selected</span><span class="cm">,</span>\<span class="i">$kitten_image</span><span class="cm">,</span><span class="i">$kitten_tag</span><span class="s">)</span><span class="s">}</span><span class="cm">,</span>
<a name="mod13.pl.33"></a>  33 	                 -<span class="w">variable</span> <span class="cm">=&gt;</span> \<span class="i">$extra_nice_selected</span><span class="cm">,</span> -<span class="w">onvalue</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span> -<span class="w">offvalue</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.34"></a>  34     <span class="k">my</span> <span class="i">$button_lights</span> = <span class="i">$root</span><span class="i">-&gt;new_ttk__button</span><span class="s">(</span>-<span class="w">text</span> <span class="cm">=&gt;</span> <span class="q">&quot;Turn on the lights&quot;</span><span class="cm">,</span> -<span class="w">command</span> <span class="cm">=&gt;</span> <span class="k">sub</span> <span class="s">{</span><span class="i">turn_on_lights</span><span class="s">(</span>\<span class="i">$canvas</span><span class="cm">,</span>\<span class="i">$checkbox_blink</span><span class="cm">,</span>\<span class="i">$do_blink</span><span class="cm">,</span><span class="i">@lights</span><span class="s">)</span><span class="sc">;</span><span class="s">}</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.35"></a>  35     <span class="k">my</span> <span class="i">$button_nolights</span> = <span class="i">$root</span><span class="i">-&gt;new_ttk__button</span><span class="s">(</span>-<span class="w">text</span> <span class="cm">=&gt;</span> <span class="q">&quot;Turn off the lights&quot;</span><span class="cm">,</span> -<span class="w">command</span> <span class="cm">=&gt;</span> <span class="k">sub</span> <span class="s">{</span><span class="i">turn_off_lights</span><span class="s">(</span>\<span class="i">$canvas</span><span class="cm">,</span>\<span class="i">$checkbox_blink</span><span class="cm">,</span>\<span class="i">$do_blink</span><span class="cm">,</span><span class="i">@lights</span><span class="s">)</span><span class="sc">;</span><span class="s">}</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.36"></a>  36     <span class="k">my</span> <span class="i">$button_naughty</span> = <span class="i">$root</span><span class="i">-&gt;new_ttk__button</span><span class="s">(</span>-<span class="w">text</span> <span class="cm">=&gt;</span> <span class="q">&quot;Naughty&quot;</span><span class="cm">,</span> -<span class="w">command</span> <span class="cm">=&gt;</span> <span class="k">sub</span><span class="s">{</span><span class="i">naughty</span><span class="s">(</span>\<span class="i">$canvas</span><span class="cm">,</span>\<span class="i">$checkbox_xnice</span><span class="cm">,</span>\<span class="i">$extra_nice_selected</span><span class="cm">,</span><span class="i">$presents_tag</span><span class="cm">,</span><span class="i">$kitten_tag</span><span class="s">)</span><span class="sc">;</span><span class="s">}</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.37"></a>  37     <span class="k">my</span> <span class="i">$button_nice</span> = <span class="i">$root</span><span class="i">-&gt;new_ttk__button</span><span class="s">(</span>-<span class="w">text</span> <span class="cm">=&gt;</span> <span class="q">&quot;Nice&quot;</span><span class="cm">,</span> -<span class="w">command</span> <span class="cm">=&gt;</span> <span class="k">sub</span><span class="s">{</span><span class="i">nice</span><span class="s">(</span>\<span class="i">$canvas</span><span class="cm">,</span>\<span class="i">$checkbox_xnice</span><span class="cm">,</span>\<span class="i">$presents_image</span><span class="cm">,</span><span class="i">$presents_tag</span><span class="s">)</span><span class="sc">;</span><span class="s">}</span><span class="s">)</span><span class="sc">;</span>  
<a name="mod13.pl.38"></a>  38 
<a name="mod13.pl.39"></a>  39     <span class="k">my</span> <span class="i">$row_start</span> = <span class="n">1</span><span class="sc">;</span>
<a name="mod13.pl.40"></a>  40     <span class="i">$canvas</span><span class="i">-&gt;g_grid</span><span class="s">(</span>-<span class="w">column</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="cm">,</span> -<span class="w">row</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="cm">,</span> -<span class="w">columnspan</span> <span class="cm">=&gt;</span> <span class="n">7</span><span class="cm">,</span> -<span class="w">rowspan</span> <span class="cm">=&gt;</span> <span class="i">$row_start</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.41"></a>  41     
<a name="mod13.pl.42"></a>  42     <span class="i">$button_naughty</span><span class="i">-&gt;g_grid</span><span class="s">(</span>-<span class="w">column</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="cm">,</span> -<span class="w">row</span> <span class="cm">=&gt;</span> <span class="i">$row_start</span>+<span class="n">1</span><span class="cm">,</span> -<span class="w">columnspan</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.43"></a>  43     <span class="i">$button_nice</span><span class="i">-&gt;g_grid</span><span class="s">(</span>-<span class="w">column</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span> -<span class="w">row</span> <span class="cm">=&gt;</span> <span class="i">$row_start</span>+<span class="n">1</span><span class="cm">,</span> -<span class="w">columnspan</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.44"></a>  44     <span class="i">$checkbox_xnice</span><span class="i">-&gt;g_grid</span><span class="s">(</span>-<span class="w">column</span> <span class="cm">=&gt;</span> <span class="n">2</span><span class="cm">,</span> -<span class="w">row</span> <span class="cm">=&gt;</span> <span class="i">$row_start</span>+<span class="n">1</span><span class="cm">,</span> -<span class="w">columnspan</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.45"></a>  45     <span class="i">$checkbox_xnice</span><span class="i">-&gt;state</span><span class="s">(</span><span class="q">&quot;disabled&quot;</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.46"></a>  46     
<a name="mod13.pl.47"></a>  47     <span class="i">$button_lights</span><span class="i">-&gt;g_grid</span><span class="s">(</span>-<span class="w">column</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="cm">,</span> -<span class="w">row</span> <span class="cm">=&gt;</span> <span class="i">$row_start</span>+<span class="n">3</span><span class="cm">,</span> -<span class="w">columnspan</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.48"></a>  48     <span class="i">$button_nolights</span><span class="i">-&gt;g_grid</span><span class="s">(</span>-<span class="w">column</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span> -<span class="w">row</span> <span class="cm">=&gt;</span> <span class="i">$row_start</span>+<span class="n">3</span><span class="cm">,</span> -<span class="w">columnspan</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.49"></a>  49     <span class="i">$checkbox_blink</span><span class="i">-&gt;g_grid</span><span class="s">(</span>-<span class="w">column</span> <span class="cm">=&gt;</span> <span class="n">2</span><span class="cm">,</span> -<span class="w">row</span> <span class="cm">=&gt;</span> <span class="i">$row_start</span>+<span class="n">3</span><span class="cm">,</span> -<span class="w">columnspan</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span> 
<a name="mod13.pl.50"></a>  50     <span class="i">$checkbox_blink</span><span class="i">-&gt;state</span><span class="s">(</span><span class="q">&quot;disabled&quot;</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.51"></a>  51     <span class="i">turn_off_lights</span><span class="s">(</span>\<span class="i">$canvas</span><span class="cm">,</span>\<span class="i">$checkbox_blink</span><span class="cm">,</span>\<span class="i">$do_blink</span><span class="cm">,</span><span class="i">@lights</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.52"></a>  52     <span class="i">blink_lights</span><span class="s">(</span>\<span class="i">$canvas</span><span class="cm">,</span>\<span class="i">$do_blink</span><span class="cm">,</span><span class="i">@lights</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.53"></a>  53 <span class="s">}</span>
<a name="mod13.pl.54"></a>  54 
<a name="string_lights"></a>  55 <span class="k">sub </span><span class="m">string_lights</span><span class="s">{</span>
<a name="mod13.pl.56"></a>  56     <span class="k">my</span><span class="s">(</span><span class="i">$canvas</span><span class="s">)</span>=<span class="i">@_</span><span class="sc">;</span>
<a name="mod13.pl.57"></a>  57     <span class="k">my</span> <span class="i">@light_ids</span><span class="sc">;</span>
<a name="mod13.pl.58"></a>  58     <span class="k">my</span> <span class="s">(</span><span class="i">$x_top_left</span><span class="cm">,</span><span class="i">$y_top_left</span><span class="cm">,</span><span class="i">$x_bottom_right</span><span class="cm">,</span><span class="i">$y_bottom_right</span><span class="s">)</span>=<span class="s">(</span><span class="n">142.00</span><span class="cm">,</span><span class="n">68.00</span><span class="cm">,</span><span class="n">146.00</span><span class="cm">,</span><span class="n">74.00</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.59"></a>  59     <span class="k">foreach</span> <span class="k">my</span> <span class="i">$row_index</span> <span class="s">(</span><span class="n">0</span>..<span class="n">10</span><span class="s">)</span><span class="s">{</span>
<a name="mod13.pl.60"></a>  60         <span class="k">foreach</span> <span class="k">my</span> <span class="i">$light_index</span> <span class="s">(</span><span class="n">0</span>..<span class="n">10</span>+<span class="s">(</span><span class="i">$row_index</span>-<span class="n">5</span><span class="s">)</span><span class="s">)</span><span class="s">{</span>
<a name="mod13.pl.61"></a>  61             <span class="k">my</span> <span class="i">$scatter</span>=<span class="k">rand</span><span class="s">(</span><span class="n">7</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.62"></a>  62             <span class="i">$light_index</span>=<span class="i">$light_index</span>*<span class="n">10</span><span class="sc">;</span>
<a name="mod13.pl.63"></a>  63             <span class="k">my</span> <span class="i">$light</span>=<span class="i">$$canvas</span><span class="i">-&gt;create_oval</span><span class="s">(</span><span class="i">$x_top_left</span>+<span class="i">$light_index</span><span class="cm">,</span><span class="i">$y_top_left</span>+<span class="i">$scatter</span><span class="cm">,</span><span class="i">$x_bottom_right</span>+<span class="i">$light_index</span><span class="cm">,</span><span class="i">$y_bottom_right</span>+<span class="i">$scatter</span><span class="cm">,</span> -<span class="w">fill</span> <span class="cm">=&gt;</span> <span class="q">&quot;yellow&quot;</span><span class="cm">,</span> -<span class="w">tags</span> <span class="cm">=&gt;</span> <span class="q">&quot;palette palettered&quot;</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.64"></a>  64             <span class="k">unshift</span> <span class="i">@light_ids</span><span class="cm">,</span> <span class="i">$light</span><span class="sc">;</span>
<a name="mod13.pl.65"></a>  65         <span class="s">}</span>
<a name="mod13.pl.66"></a>  66         <span class="s">(</span><span class="i">$x_top_left</span><span class="cm">,</span><span class="i">$y_top_left</span><span class="cm">,</span><span class="i">$x_bottom_right</span><span class="cm">,</span><span class="i">$y_bottom_right</span><span class="s">)</span>=<span class="s">(</span><span class="i">$x_top_left</span>-<span class="n">5</span><span class="cm">,</span><span class="i">$y_top_left</span>+<span class="n">15</span><span class="cm">,</span><span class="i">$x_bottom_right</span>-<span class="n">5</span><span class="cm">,</span><span class="i">$y_bottom_right</span>+<span class="n">15</span><span class="s">)</span>
<a name="mod13.pl.67"></a>  67     <span class="s">}</span>
<a name="mod13.pl.68"></a>  68     <span class="k">return</span> <span class="i">@light_ids</span><span class="sc">;</span>
<a name="mod13.pl.69"></a>  69 <span class="s">}</span>
<a name="mod13.pl.70"></a>  70 
<a name="turn_on_lights"></a>  71 <span class="k">sub </span><span class="m">turn_on_lights()</span><span class="s">{</span>
<a name="mod13.pl.72"></a>  72     <span class="k">my</span><span class="s">(</span><span class="i">$canvas</span><span class="cm">,</span><span class="i">$checkbox</span><span class="cm">,</span><span class="i">$checkbox_selected</span><span class="cm">,</span><span class="i">@lights</span><span class="s">)</span>=<span class="i">@_</span><span class="sc">;</span>
<a name="mod13.pl.73"></a>  73     <span class="k">foreach</span> <span class="k">my</span> <span class="i">$light_id</span> <span class="s">(</span><span class="i">@lights</span><span class="s">)</span><span class="s">{</span>
<a name="mod13.pl.74"></a>  74         <span class="i">$$canvas</span><span class="i">-&gt;itemconfigure</span><span class="s">(</span><span class="i">$light_id</span><span class="cm">,</span> -<span class="w">state</span> <span class="cm">=&gt;</span> <span class="q">&quot;normal&quot;</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.75"></a>  75     <span class="s">}</span>
<a name="mod13.pl.76"></a>  76     <span class="i">$$checkbox</span><span class="i">-&gt;state</span><span class="s">(</span><span class="q">&quot;!disabled&quot;</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.77"></a>  77     <span class="i">$$checkbox_selected</span>=<span class="n">0</span><span class="sc">;</span>
<a name="mod13.pl.78"></a>  78 <span class="s">}</span>
<a name="mod13.pl.79"></a>  79 
<a name="turn_off_lights"></a>  80 <span class="k">sub </span><span class="m">turn_off_lights()</span><span class="s">{</span>
<a name="mod13.pl.81"></a>  81     <span class="k">my</span><span class="s">(</span><span class="i">$canvas</span><span class="cm">,</span><span class="i">$checkbox</span><span class="cm">,</span><span class="i">$checkbox_selected</span><span class="cm">,</span><span class="i">@lights</span><span class="s">)</span>=<span class="i">@_</span><span class="sc">;</span>
<a name="mod13.pl.82"></a>  82     <span class="k">foreach</span> <span class="k">my</span> <span class="i">$light_id</span> <span class="s">(</span><span class="i">@lights</span><span class="s">)</span><span class="s">{</span>        
<a name="mod13.pl.83"></a>  83         <span class="i">$$canvas</span><span class="i">-&gt;itemconfigure</span><span class="s">(</span><span class="i">$light_id</span><span class="cm">,</span> -<span class="w">state</span> <span class="cm">=&gt;</span> <span class="q">&quot;hidden&quot;</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.84"></a>  84     <span class="s">}</span>
<a name="mod13.pl.85"></a>  85     <span class="i">$$checkbox</span><span class="i">-&gt;state</span><span class="s">(</span><span class="q">&quot;disabled&quot;</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.86"></a>  86     <span class="i">$$checkbox_selected</span>=<span class="n">0</span><span class="sc">;</span>
<a name="mod13.pl.87"></a>  87 <span class="s">}</span>
<a name="mod13.pl.88"></a>  88 
<a name="blink_lights"></a>  89 <span class="k">sub </span><span class="m">blink_lights</span><span class="s">{</span>
<a name="mod13.pl.90"></a>  90     <span class="k">my</span><span class="s">(</span><span class="i">$canvas</span><span class="cm">,</span><span class="i">$do_blink</span><span class="cm">,</span><span class="i">@lights</span><span class="s">)</span>=<span class="i">@_</span><span class="sc">;</span>
<a name="mod13.pl.91"></a>  91     <span class="i">repeat</span><span class="s">(</span><span class="n">1000</span><span class="cm">,</span><span class="k">sub</span><span class="s">{</span><span class="i">blink_switch</span><span class="s">(</span><span class="i">$canvas</span><span class="cm">,</span><span class="i">$do_blink</span><span class="cm">,</span><span class="i">@lights</span><span class="s">)</span><span class="s">}</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.92"></a>  92 <span class="s">}</span>
<a name="mod13.pl.93"></a>  93 
<a name="blink_switch"></a>  94 <span class="k">sub </span><span class="m">blink_switch</span><span class="s">{</span>
<a name="mod13.pl.95"></a>  95     <span class="k">my</span><span class="s">(</span><span class="i">$canvas</span><span class="cm">,</span><span class="i">$do_blink</span><span class="cm">,</span><span class="i">@lights</span><span class="s">)</span>=<span class="i">@_</span><span class="sc">;</span>
<a name="mod13.pl.96"></a>  96     <span class="k">my</span> <span class="i">@lights_off</span><span class="sc">;</span>
<a name="mod13.pl.97"></a>  97     <span class="k">my</span> <span class="i">$random_off_switch</span><span class="sc">;</span>
<a name="mod13.pl.98"></a>  98     <span class="k">if</span><span class="s">(</span><span class="i">$$do_blink</span><span class="s">)</span><span class="s">{</span>
<a name="mod13.pl.99"></a>  99         <span class="k">foreach</span> <span class="k">my</span> <span class="i">$light_id</span> <span class="s">(</span><span class="i">@lights</span><span class="s">)</span><span class="s">{</span> 
<a name="mod13.pl.100"></a> 100             <span class="i">$random_off_switch</span>=<span class="s">(</span><span class="k">rand</span><span class="s">(</span><span class="s">)</span>&lt;<span class="n">.5</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.101"></a> 101             <span class="k">if</span><span class="s">(</span><span class="i">$random_off_switch</span><span class="s">)</span><span class="s">{</span>
<a name="mod13.pl.102"></a> 102                 <span class="i">$$canvas</span><span class="i">-&gt;itemconfigure</span><span class="s">(</span><span class="i">$light_id</span><span class="cm">,</span> -<span class="w">state</span> <span class="cm">=&gt;</span> <span class="q">&quot;hidden&quot;</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.103"></a> 103                 <span class="k">unshift</span> <span class="i">@lights_off</span><span class="cm">,</span> <span class="i">$light_id</span><span class="sc">;</span>
<a name="mod13.pl.104"></a> 104             <span class="s">}</span>
<a name="mod13.pl.105"></a> 105         <span class="s">}</span>
<a name="mod13.pl.106"></a> 106         <span class="i">Tkx::update</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.107"></a> 107         <span class="i">Tkx::after</span><span class="s">(</span><span class="n">500</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.108"></a> 108         <span class="k">foreach</span> <span class="k">my</span> <span class="i">$off_light_id</span> <span class="s">(</span><span class="i">@lights_off</span><span class="s">)</span><span class="s">{</span>
<a name="mod13.pl.109"></a> 109             <span class="i">$$canvas</span><span class="i">-&gt;itemconfigure</span><span class="s">(</span><span class="i">$off_light_id</span><span class="cm">,</span> -<span class="w">state</span> <span class="cm">=&gt;</span> <span class="q">&quot;normal&quot;</span><span class="s">)</span><span class="sc">;</span> 
<a name="mod13.pl.110"></a> 110         <span class="s">}</span>
<a name="mod13.pl.111"></a> 111         <span class="i">Tkx::update</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.112"></a> 112     <span class="s">}</span>
<a name="mod13.pl.113"></a> 113 <span class="s">}</span>
<a name="mod13.pl.114"></a> 114 
<a name="naughty"></a> 115 <span class="k">sub </span><span class="m">naughty</span><span class="s">{</span>
<a name="mod13.pl.116"></a> 116     <span class="k">my</span><span class="s">(</span><span class="i">$canvas</span><span class="cm">,</span><span class="i">$checkbox</span><span class="cm">,</span><span class="i">$checkbox_selected</span><span class="cm">,</span><span class="i">$presents_tag</span><span class="cm">,</span><span class="i">$kitten_tag</span><span class="s">)</span>=<span class="i">@_</span><span class="sc">;</span>
<a name="mod13.pl.117"></a> 117     <span class="i">$$canvas</span><span class="i">-&gt;delete</span><span class="s">(</span><span class="i">$presents_tag</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.118"></a> 118     <span class="i">$$canvas</span><span class="i">-&gt;delete</span><span class="s">(</span><span class="i">$kitten_tag</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.119"></a> 119     <span class="i">$$checkbox</span><span class="i">-&gt;state</span><span class="s">(</span><span class="q">&quot;disabled&quot;</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.120"></a> 120     <span class="i">$$checkbox_selected</span>=<span class="n">0</span><span class="sc">;</span>
<a name="mod13.pl.121"></a> 121 <span class="s">}</span>
<a name="mod13.pl.122"></a> 122 
<a name="nice"></a> 123 <span class="k">sub </span><span class="m">nice</span><span class="s">{</span>
<a name="mod13.pl.124"></a> 124     <span class="k">my</span><span class="s">(</span><span class="i">$canvas</span><span class="cm">,</span><span class="i">$checkbox</span><span class="cm">,</span><span class="i">$presents</span><span class="cm">,</span><span class="i">$tag</span><span class="s">)</span>=<span class="i">@_</span><span class="sc">;</span>  
<a name="mod13.pl.125"></a> 125     <span class="i">$$canvas</span><span class="i">-&gt;create_image</span><span class="s">(</span><span class="s">[</span><span class="n">65</span><span class="cm">,</span><span class="n">325</span><span class="s">]</span><span class="cm">,</span>-<span class="w">image</span> <span class="cm">=&gt;</span> <span class="i">$$presents</span><span class="cm">,</span> -<span class="w">tag</span><span class="cm">=&gt;</span><span class="i">$tag</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.126"></a> 126     <span class="i">$$checkbox</span><span class="i">-&gt;state</span><span class="s">(</span><span class="q">&quot;!disabled&quot;</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.127"></a> 127 <span class="s">}</span>
<a name="mod13.pl.128"></a> 128 
<a name="extra_nice"></a> 129 <span class="k">sub </span><span class="m">extra_nice</span><span class="s">{</span>
<a name="mod13.pl.130"></a> 130     <span class="k">my</span><span class="s">(</span><span class="i">$canvas</span><span class="cm">,</span><span class="i">$extra_nice_selected</span><span class="cm">,</span><span class="i">$kitten</span><span class="cm">,</span><span class="i">$tag</span><span class="s">)</span>=<span class="i">@_</span><span class="sc">;</span>  
<a name="mod13.pl.131"></a> 131     <span class="k">if</span><span class="s">(</span><span class="i">$$extra_nice_selected</span><span class="s">)</span><span class="s">{</span>
<a name="mod13.pl.132"></a> 132         <span class="i">$$canvas</span><span class="i">-&gt;create_image</span><span class="s">(</span><span class="s">[</span><span class="n">297</span><span class="cm">,</span><span class="n">310</span><span class="s">]</span><span class="cm">,</span>-<span class="w">image</span> <span class="cm">=&gt;</span> <span class="i">$$kitten</span><span class="cm">,</span> -<span class="w">tag</span><span class="cm">=&gt;</span><span class="i">$tag</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.133"></a> 133     <span class="s">}</span>
<a name="mod13.pl.134"></a> 134     <span class="k">else</span><span class="s">{</span>
<a name="mod13.pl.135"></a> 135         <span class="i">$$canvas</span><span class="i">-&gt;delete</span><span class="s">(</span><span class="i">$tag</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.136"></a> 136     <span class="s">}</span>
<a name="mod13.pl.137"></a> 137 <span class="s">}</span>
<a name="mod13.pl.138"></a> 138 
<a name="mod13.pl.139"></a> 139 <span class="c"># Implementation of a function like Perl/Tk&#39;s repeat</span>
<a name="mod13.pl.140"></a> 140 <span class="c"># from http://www.nntp.perl.org/group/perl.tcltk/2010/02/msg381.html</span>
<a name="mod13.pl.141"></a> 141 <span class="c"># for additional discussion see http://www.perlmonks.org/index.pl?node_id=728516</span>
<a name="repeat"></a> 142 <span class="k">sub </span><span class="m">repeat</span><span class="s">{</span>
<a name="mod13.pl.143"></a> 143     <span class="k">my</span> <span class="i">$ms</span>  = <span class="k">shift</span><span class="sc">;</span>
<a name="mod13.pl.144"></a> 144     <span class="k">my</span> <span class="i">$sub</span> = <span class="k">shift</span><span class="sc">;</span>
<a name="mod13.pl.145"></a> 145     <span class="k">my</span> <span class="i">$repeater</span><span class="sc">;</span> <span class="c"># repeat wrapper</span>
<a name="mod13.pl.146"></a> 146     <span class="i">$repeater</span> = <span class="k">sub</span> <span class="s">{</span> <span class="i">$sub</span>-&gt;<span class="s">(</span><span class="i">@_</span><span class="s">)</span><span class="sc">;</span> <span class="i">Tkx::after</span><span class="s">(</span><span class="i">$ms</span><span class="cm">,</span> <span class="i">$repeater</span><span class="s">)</span><span class="sc">;</span><span class="s">}</span><span class="sc">;</span>
<a name="mod13.pl.147"></a> 147     <span class="k">my</span> <span class="i">$repeat_id</span>=<span class="i">Tkx::after</span><span class="s">(</span><span class="i">$ms</span><span class="cm">,</span> <span class="i">$repeater</span><span class="s">)</span><span class="sc">;</span>
<a name="mod13.pl.148"></a> 148     <span class="k">return</span> <span class="i">$repeat_id</span><span class="sc">;</span>
<a name="mod13.pl.149"></a> 149 <span class="s">}</span>
</pre>
<p><a name="footnote_note0" id="footnote_note0"></a>1. Info about <tt><span title="Tkx">Tkx</span></tt> <a href="http://code.activestate.com/lists/activeperl/19918/"> straight from the horse's mouth</a>.<br>
</p>
<p><a name="footnote_note1" id="footnote_note1"></a>2. <a href="http://www.tkdocs.com/tutorial/canvas.html#tags">Think classes in CSS</a><br>
</p>
<div style="float: right; font-size: 10pt"><a href="mod13.pod">View Source (POD)</a></div><br />
</body>
</html>
